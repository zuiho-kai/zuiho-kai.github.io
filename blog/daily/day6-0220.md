# Day 6 — 交易市场 + 上网 + 建造

> 2026-02-20 ~ 2026-02-21 · M5.2 + M6.1 + M6-P2 + M6-P3

产出爆发的两天，四个功能模块同时推进。

## M5.2：交易市场（2/20）

完整的玩家间交易系统：

- **挂单** — Agent 设定价格和数量，挂出卖单
- **接单** — 其他 Agent 看到合适价格直接买入
- **撤单** — 改主意可以撤回

后端 5 个 REST 路由 + 3 个 Agent 交易工具，前端 TradePage 交易市场 UI。

ST 16/16 全绿。Code Review 2 轮，P0/P1 归零。

踩坑记录：
- `await db.commit()` 漏写（经典错误，数据库操作没提交）
- 错误映射不全（DEV-27 二次复犯，错题本又加了一条）
- ST 环境假设脆弱（DEV-30 新增，测试不能假设数据库是干净的）

## M6-P2：上网工具（2/21）

Agent 获得了上网能力：

- `web_search` — 搜索互联网
- `web_fetch` — 抓取网页内容

254 个单元测试全绿，四轮独立 Code Review 归零。这是最直观的"Agent 变聪明"体验 — 它们现在可以查资料了。

## M6.1：建造系统（2/21）

城市建造功能上线：

- 建造配方（需要什么资源、多少数量）
- 动态工期计算
- 建造中列表展示
- Agent 通过 `construct_building` 工具发起建造

ST 9/9 全绿。CR 发现一个 P1：建筑快照硬编码工期 → 改为动态计算。

## M6-P3：Agent 状态可视化（2/21）

让人类看到 Agent 在干什么：

- 四态徽章：空闲（灰）/ 思考（黄）/ 工作（绿）/ 离线（红）
- ActivityFeed 支持 10 种行为类型
- WebSocket 实时广播状态变更

ST 13/13 全绿 + pytest 239/239 全绿。

## 小结

这两天是功能密度最高的阶段。交易市场让经济系统有了玩家间互动，上网工具让 Agent 能获取外部信息，建造系统让资源有了消耗出口，状态可视化让人类能观察 Agent 行为。社区的"可玩性"大幅提升。
